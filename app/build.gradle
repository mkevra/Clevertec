/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java application project to get you started.
 * For more details take a look at the 'Building Java & JVM projects' chapter in the Gradle
 * User Manual available at https://docs.gradle.org/7.4/userguide/building_java_projects.html
 */

plugins {
    // Apply the application plugin to add support for building a CLI application in Java.
    id 'application'
    id 'java-library'
    id 'java-gradle-plugin'
    id "com.gradle.plugin-publish" version "0.12.0"
}

group 'ru.clevertec'
version '1.0-SNAPSHOT'

gradlePlugin {
    plugins {
        downoloadPlugin {
            id = 'ru.clevertec.file-downoloader'
            implementationClass = 'ru.clevertec.shop.plugins.FileDownoloaderPlugin'
        }
    }
}

repositories {
    // Use Maven Central for resolving dependencies.
    mavenCentral()
}

dependencies {
    // Use JUnit test framework.
    testImplementation 'junit:junit:4.13.2'

    implementation gradleApi()

    // This dependency is used by the application.
    implementation 'com.google.guava:guava:30.1.1-jre'
}

application {
    // Define the main class for the application.
    mainClass = 'ru.Clevertec.App'
}

public class CustomGradleTask extends DefaultTask {
    @Input
    String sourceUrl;

    @OutputFile
    File target;

    @TaskAction
    void downoload() throws IOException {
        try {
            URL url = new URL(sourceUrl);
            HttpURLConnection httpURLConnection = (HttpURLConnection) url.openConnection();
            try (BufferedInputStream bufferedInputStream = new BufferedInputStream(httpURLConnection.getInputStream());
                 FileOutputStream fileOutputStream = new FileOutputStream(target);
                 BufferedOutputStream bufferedOutputStream = new BufferedOutputStream(fileOutputStream, 1024)) {


                byte[] buffer = new byte[1024];
                int read = 0;

                while ((read = bufferedInputStream.read(buffer, 0, 1024)) >= 0) {
                    bufferedOutputStream.write(buffer, 0, read);
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}

task downoloadFile(type: CustomGradleTask) {
    sourceUrl = "https://drive.google.com/file/d/1clwNxdkHsIvYdD7ET5XgqyaQbOwOruzk/view?usp=sharing"
    target = new File("src/main/resources/check.jpg")
}
